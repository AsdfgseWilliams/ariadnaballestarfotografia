---
import { getLangFromUrl, useTranslations } from "src/i18n/utils";

const lang = getLangFromUrl(Astro.url) as "es" | "en";
const t = useTranslations(lang);

const slides = [
  {
    title: t("photoshoots.familiar.mini.title"),
    description: t("photoshoots.familiar.mini.description"),
    details: JSON.parse(t("photoshoots.familiar.mini.details")),
    price: t("photoshoots.familiar.mini.price"),
  },
  {
    title: t("photoshoots.familiar.reportaje.title"),
    description: t("photoshoots.familiar.reportaje.description"),
    details: JSON.parse(t("photoshoots.familiar.reportaje.details")),
    price: t("photoshoots.familiar.reportaje.price"),
  },
  {
    title: t("photoshoots.familiar.experiencia.title"),
    description: t("photoshoots.familiar.experiencia.description"),
    details: JSON.parse(t("photoshoots.familiar.experiencia.details")),
    price: t("photoshoots.familiar.experiencia.price"),
  },
];
---

<section class="bg-cover bg-no-repeat py-24 bg-center"
  style="background-image: url('/img/32.webp'), linear-gradient(-90deg, rgba(255,255,255,0.65) 50%, #ffffff 50%); background-blend-mode: overlay;">
  <div class="max-w-7xl mx-auto">
    <section class="grid grid-cols-1 md:grid-cols-3 gap-10 p-8">
      <div class="flex justify-center items-start">
        <img src="/img/34.webp" alt="Ariadna" class="w-full h-auto">
      </div>

      <div>
        <h2 class="uppercase">{t('photoshoots.familiar.h2')}</h2>
        <img src="/img/33.webp" alt="Ariadna" class="w-full h-auto">
      </div>

      <div class="flex flex-col justify-center items-center text-sm">
        <div class="relative w-full max-w-3xl h-auto">
          <!-- Slides -->
          <div
            class="slider"
            id="slider-familiar"
            data-slides={JSON.stringify(slides)}
          ></div>

          <a href="#contactForm" class="link-button mt-8">
            {t('photoshoots.familiar.button')}
          </a>

          <!-- Navigation Arrows -->
          <button class="absolute top-1/2 left-2 transform -translate-y-1/2" id="prevFamiliar" aria-label="Anterior">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 6l-6 6l6 6" /></svg>
          </button>
          <button class="absolute top-1/2 right-2 transform -translate-y-1/2" id="nextFamiliar" aria-label="Siguiente">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 6l6 6l-6 6" /></svg>
          </button>
        </div>
      </div>
    </section>
  </div>
</section>

<style>
  .slider {
    position: relative;
    width: 100%;
    height: auto;
    overflow: hidden;
  }
  .slider .fade {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
    display: none;
  }
  .slider .active {
    opacity: 1;
    display: block;
  }
</style>

<script type="module">
  const sliderFamiliar = document.getElementById("slider-familiar");
  const raw = sliderFamiliar?.dataset.slides || "[]";
  const slides = JSON.parse(raw);

  slides.forEach((slide) => {
    const slideDiv = document.createElement("div");
    slideDiv.classList.add("fade", "flex", "flex-col", "justify-center", "text-gray-800", "p-4");
    slideDiv.innerHTML = `
      <h3 class="text-5xl">${slide.title}</h3>
      <p class="mt-4">${slide.description}</p>
      <ul class="mt-4">
        ${slide.details.map((detail) => `<li>â€¢ ${detail}</li>`).join("")}
      </ul>
      <hr class="my-4 bg-slate-900">
      <p class="font-claster text-4xl">${slide.price}</p>
    `;
    sliderFamiliar.appendChild(slideDiv);
  });

  let currentSlide = 0;
  const slidesEls = sliderFamiliar.querySelectorAll(".fade");

  // init
  slidesEls.forEach((el, i) => {
    el.classList.toggle("active", i === 0);
    el.style.display = i === 0 ? "block" : "none";
  });

  function showSlide(index) {
    const nodes = sliderFamiliar.querySelectorAll(".fade");
    nodes[currentSlide].classList.remove("active");
    nodes[currentSlide].style.display = "none";
    currentSlide = (index + nodes.length) % nodes.length;
    nodes[currentSlide].classList.add("active");
    nodes[currentSlide].style.display = "block";
  }

  document.getElementById("prevFamiliar")?.addEventListener("click", () => showSlide(currentSlide - 1));
  document.getElementById("nextFamiliar")?.addEventListener("click", () => showSlide(currentSlide + 1));
</script>
